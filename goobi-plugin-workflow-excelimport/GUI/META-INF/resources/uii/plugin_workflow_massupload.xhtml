<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:composite="http://xmlns.jcp.org/jsf/composite" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:p="http://primefaces.org/ui">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

		 <style>
			#upload .ui-widget-content {
				border: none;
			}
			
			#upload .ui-widget-header {
			    background: #fff none repeat scroll 0 0;
			}
			
			#upload .ui-fileupload-choose {
			    background: #368ee0 none repeat scroll 0 0;
			    color: #fff;
			    text-shadow: none;
			    border: 0 none;
			    padding: 0.3em 1em;
			    font-weight: 400;
			}
			
			#upload .ui-fileupload-buttonbar span.ui-button .ui-button-text {
			    padding: 0.3em 1em;
			}
			
			#upload .ui-fileupload-buttonbar span.ui-button span.ui-button-icon-left {
			    display: none;
			}
			
			#upload .ui-fileupload-files {
			    width: 100%;
			}
			
			.ui-fileupload-content .ui-progressbar {
			    width: 100px;
			    height: 20px;
			    margin: 0px;
			}

			#upload .ui-fileupload-files td:first-child {
			    display: none;
			}
			
			.draganddroparea {
				border: 2px dashed silver;
				padding-top:20px;
				
			}
			
			.bg-gray{
				background-color: #ccc;
			}
			
/* 			.process-parameters {} */
/* 			.process-parameters .row { */
/* 				border-bottom: 1px solid #ccc; */
/* 			} */
/* 			.process-parameters [class*="col-"] { */
/* 				padding: 0; */
/* 			} */
/* 			.process-parameters__key, */
/* 			.process-parameters__value { */
/* 			} */
/* 			.process-parameters__key { */
/* 				padding: 15px; */
/* 				background-color: #eee; */
/* 			} */
/* 			.process-parameters__value { */
/* 				padding: 12px 15px 11px 15px; */
/* 			} */
		</style>

        <h:outputText styleClass="alert alert-danger block margin-top-most" value="#{msgs.noAccessAllowed} Plugin_Goobi_Massupload" 
        	rendered="#{!LoginForm.hasRole('Plugin_Goobi_Massupload')}"/>
        
        <h:panelGroup rendered="#{LoginForm.hasRole('Plugin_Goobi_Massupload')}">
			<div class="row">
				<div class="col-sm-12">
					<!--  list of all rows in uploaded excelfile -->
					<div class="row">
						<h:panelGroup id="actionform"  styleClass="col-xs-7" >
							<div class="box box-color box-bordered lightgrey" >
								<div class="box-title">
									<h3>
										<h:outputText value="#{msgs.plugin_yerushaExcelImport_validationResults}" />
									</h3>
								</div>
								<div class="box-content">
									<ui:fragment rendered="#{NavigationForm.workflowPlugin.rowList == null}" style="text-align:center;">
									<p style="text-align:center; font-size:large;">#{msgs.plugin_yerushaExcelImport_noValidation}</p>
									</ui:fragment>
					 				<ui:repeat var="row" value="#{NavigationForm.workflowPlugin.rowList}">
					 					<div class="row">
											<ui:repeat var="metadatum" value="#{row.contentList}">
												<div class="row">
													<div class="col-xs-4">
														<font color="#{metadatum.valid?'black':'red'}">#{metadatum.headername}</font>
													</div>
													<div class="col-xs-8">
														<font color="#{metadatum.valid?'black':'red'}">#{metadatum.value==''?'[empty field]':metadatum.value}</font>
													</div>
												</div>
											</ui:repeat>											
											<hr/>
										</div>
									</ui:repeat>
								</div>
							</div>	
						</h:panelGroup>
						<h:panelGroup class="col-xs-5">
							<div class="box box-color box-bordered orange">
								<div class="box-title">
									<h3>
										<h:outputText value="#{msgs.plugin_yerushaExcelImport_uploadArea}" />
									</h3>
								</div>
								<div class="box-content">
									<div class="row">
										<div class="col-xs-5">
											#{msgs.plugin_yerushaExcelImport_UploadExcelFile}
										</div>
										<div class="col-xs-7">
											<h:form id="uploadform" prependId="false"  >
											 	<p:fileUpload fileUploadListener="#{NavigationForm.workflowPlugin.uploadFile}" id="upload" auto="true"
													style="text-align:center;" mode="advanced" multiple="true" dragDropSupport="true"
													label="#{msgs.plugin_massupload_selectFiles}" sizeLimit="1000000000000"
													allowTypes="#{NavigationForm.workflowPlugin.allowedTypes}" 
													oncomplete="if(this.files.length == 0) sortFiles()" 
													update=":actionform :processParameters"/>
											</h:form>
										</div>
									</div>
									<h:panelGroup  id="processParameters">
										<ui:fragment  rendered="#{NavigationForm.workflowPlugin.rowList.size() > 0}" >
											<h:form>
											<div class="process-parameters">
												<hr/>
												<div class="row">
													<div class="col-xs-5">
														<div class="process-parameters__key">
															#{msgs.plugin_yerushaExcelImport_batchName}
														</div>														
													</div>
													<div class="col-xs-7">
														<div class="process-parameters__value">
															<h:inputText value="#{NavigationForm.workflowPlugin.batchName}" id="batchName" class="form-control"></h:inputText>
														</div>
													</div>
												</div>
												<hr/>
												<div class="row">
													<div class="col-xs-5">
														<div class="process-parameters__key">
														#{msgs.plugin_yerushaExcelImport_manualMetadata}
														</div>
													</div>
													
													<div class="col-xs-7">
														<div class="process-parameters__value">
															<h:selectBooleanCheckbox value="#{NavigationForm.workflowPlugin.manualCorrection}">
																<f:ajax execute="@this" event="change"></f:ajax>
															</h:selectBooleanCheckbox>
														</div>
													</div>
												</div>
												<hr/>
												<div class="row">
													<div class="col-xs-5">
														<div class="process-parameters__key">
															#{msgs.plugin_yerushaExcelImport_responsbleEditor}
														</div>
													</div>
													<div class="col-xs-7">
														<div class="process-parameters__value">
															<h:selectOneMenu value="#{NavigationForm.workflowPlugin.userName}" id="responsibleEditor" class="form-control">
																<f:selectItems value="#{NavigationForm.workflowPlugin.userNames}" var="process" 
																itemLabel="#{process}" itemValue="#{process}">
																</f:selectItems>
																<f:ajax execute="@this" event="change"></f:ajax>
															</h:selectOneMenu>
														</div>
													</div>
												</div>
												<hr/>
												<div class="row">
													<div class="col-xs-5">
														<div class="process-parameters__key">
															#{msgs.plugin_yerushaExcelImport_workflow}
														</div>
													</div>
													<div class="col-xs-7">
														<div class="process-parameters__value">
															<h:selectOneMenu value="#{NavigationForm.workflowPlugin.templateName}" class="form-control">
																<f:selectItems value="#{NavigationForm.workflowPlugin.templateNames}" var="process" 
																itemLabel="#{process}" itemValue="#{process}">
																</f:selectItems>
																<f:ajax execute="@this" event="change" render="responsibleEditor"></f:ajax>
															</h:selectOneMenu>
														</div>
													</div>
												</div>
											</div>
											<hr/>
											<div class="row">
												<div class="col-xs-9">
													<font color="red">#{NavigationForm.workflowPlugin.invalidFields}</font>
												</div>
												<div class="col-xs-3">
													<h:commandButton type="button" class=" btn btn-success" value="Create processes" action="#{NavigationForm.workflowPlugin.startImport()}">
														<f:ajax render="@none" execute="@this batchName">
															
														</f:ajax>
													</h:commandButton>
												</div>
											</div>
												</h:form>
										</ui:fragment>
									</h:panelGroup>
								</div>
							</div>
						
						</h:panelGroup>
					</div>
				</div>
			</div>
        </h:panelGroup>

    </composite:implementation>

</ui:composition>